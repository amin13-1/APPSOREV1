<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>متجر التطبيقات</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <style>
        /* --- NEW: Custom Font Integration --- */
        @font-face {
            font-family: 'gold_font';
            src: url('gold_font.ttf') format('truetype');
        }

        :root{--primary-color:#1a73e8;--background-color:#f5f5f7;--surface-color:#ffffff;--text-color:#1f1f1f;--text-secondary-color:#5f6368;--skeleton-color:#e0e0e0;}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            font-family: 'gold_font', 'Roboto', sans-serif; /* Custom font applied */
            background-color:var(--background-color);color:var(--text-color);overflow:hidden;
        }
        *:focus{-webkit-tap-highlight-color:transparent; outline:none;}
        .app-container{width:100%;height:100vh;background-color:var(--background-color);display:flex;flex-direction:column;position:relative;}
        .app-header{display:flex;align-items:center;gap:10px;padding:15px;position:fixed;top:0;width:100%;background-color:var(--surface-color);z-index:100;box-shadow: 0 2px 4px rgba(0,0,0,0.05);}
        .search-bar{flex-grow:1;background-color:#eef0f2;border-radius:25px;padding:0 15px;display:flex;align-items:center;gap:10px;color:var(--text-secondary-color);}
        .search-bar input{width:100%;border:none;background:none;padding:10px 0;font-size:1rem;font-family:inherit;}
        .search-bar input:focus{outline:none;}
        .header-icon{font-size:1.5rem;color:var(--text-secondary-color);position:relative;cursor:pointer;}
        .notification-count{position:absolute;top:-4px;right:-6px;background-color:#d93025;color:white;width:18px;height:18px;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:0.7rem;font-weight:bold;transform:scale(0);transition:transform 0.2s;}
        .notification-count.show{transform:scale(1);}
        .app-content{flex-grow:1;overflow-y:auto;padding:85px 15px 100px 15px;}
        .section{margin-bottom:30px; display:none; animation:sectionFadeIn 0.4s ease-out;}
        .section.active{display:block;}
        @keyframes sectionFadeIn{from{opacity:0;} to{opacity:1;}}
        .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}
        .section-title{font-size:1.3rem;font-weight:700;}
        .apps-grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;}
        .app-card{background:var(--surface-color); padding:15px; border-radius:24px; cursor:pointer; display:flex; gap:15px; align-items:center; opacity:0; animation:fadeInUp 0.5s ease-out forwards; transition: box-shadow 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.08);}
        .app-card:hover{box-shadow: 0 8px 16px rgba(0,0,0,0.1);}
        @keyframes fadeInUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
        .app-card img{width:80px;height:80px;border-radius:18px;flex-shrink:0;}
        .app-card .app-info{display:flex;flex-direction:column;text-align:right;width:100%;}
        .app-card .app-name{font-size:1.1rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .app-card .app-developer{font-size:0.9rem; color:var(--text-secondary-color); margin-bottom:5px;}
        .app-card .app-rating{font-size:0.9rem;color:var(--text-secondary-color);display:flex;align-items:center;gap:3px;}
        .app-card .app-rating .fa-star{color:#ffc107;font-size:0.8rem;}
        .download-btn{background-color:#eef0f2; color:var(--primary-color); border:none; border-radius:99px; padding:8px 18px; font-weight:bold; cursor:pointer; text-decoration: none; font-size: 0.9rem; transition: background-color 0.2s; margin-top:10px; align-self:flex-start; box-shadow: 0 2px 6px rgba(0,0,0,0.05);}
        .download-btn:hover{background-color:#e4e6e9;}
        .skeleton-card{display:flex;gap:15px;align-items:center;padding:15px;border-radius:24px;background:var(--surface-color);box-shadow: 0 4px 12px rgba(0,0,0,0.08);}
        .skeleton-card .img{width:80px;height:80px;border-radius:18px;background:var(--skeleton-color);position:relative;overflow:hidden;}
        .skeleton-card .text{flex-grow:1;}
        .skeleton-card .name{height:22px;border-radius:4px;background:var(--skeleton-color);margin-bottom:8px;}
        .skeleton-card .dev{width:60%;height:18px;border-radius:4px;background:var(--skeleton-color);}
        .shimmer::before{content:'';position:absolute;top:0;left:-150%;width:150%;height:100%;background:linear-gradient(to right,transparent 0%,rgba(255,255,255,0.5) 50%,transparent 100%);animation:shimmer 1.5s infinite;}
        @keyframes shimmer{100%{left:150%;}}
        .app-bottom-nav{display:flex;justify-content:space-around;position:fixed;bottom:0;width:100%;background-color:#fafafa;padding:10px 0;z-index:100;border-top:1px solid #ddd;}
        .nav-item{cursor:pointer; display:flex;flex-direction:column;align-items:center;color:var(--text-secondary-color);text-decoration:none;font-size:0.8rem;padding:5px 15px;border-radius:15px;transition:color 0.3s;}
        .nav-item.active{color:var(--primary-color);}
        .nav-item i{font-size:1.5rem;margin-bottom:4px;}
        .app-detail-page{position:fixed;top:0;left:0;width:100%;height:100%;background-color:var(--background-color);z-index:1000;transform:translateY(100%);transition:transform 0.4s cubic-bezier(0.25,1,0.5,1);display:flex;flex-direction:column;}
        .app-detail-page.show{transform:translateY(0);}
        .detail-content{flex-grow:1;overflow-y:auto;}
        .detail-header{padding:15px;display:flex;align-items:center;gap:15px;}
        .detail-header .back-btn{background:none;border:none;font-size:1.5rem;cursor:pointer;}
        .detail-header-info{display:flex;align-items:center;gap:15px;}
        .detail-header-info img{width:72px;height:72px;border-radius:16px;}
        .detail-header-info .title-group h1{font-size:1.5rem;}
        .detail-header-info .title-group p{color:var(--primary-color);font-weight:500;}
        .detail-stats{display:flex;justify-content:space-around;padding:15px;text-align:center;}
        .stat-item .value{font-weight:500;font-size:1rem;}
        .stat-item .label{font-size:0.8rem;color:var(--text-secondary-color);}
        .install-button{display:block;width:calc(100% - 30px);margin:15px;padding:15px;border:none;border-radius:12px;background-color:var(--primary-color);color:white;font-size:1.1rem;font-weight:bold;cursor:pointer;}
        .screenshots{padding:15px;}
        .screenshots-carousel{display:flex;gap:10px;overflow-x:auto;}
        .screenshots-carousel img{height:250px;border-radius:12px;}
        .description{padding:15px;line-height:1.7;}
        .description h3{margin-bottom:10px;}
        .notifications-panel{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);backdrop-filter:blur(5px);z-index:1100;display:flex;justify-content:center;align-items:center;padding:20px;opacity:0;pointer-events:none;transition:opacity 0.3s ease;}
        .notifications-panel.show{opacity:1;pointer-events:auto;}
        .panel-content{background-color:var(--surface-color);width:100%;max-width:450px;border-radius:15px;transform:scale(0.9);transition:transform 0.3s ease;max-height:80vh;display:flex;flex-direction:column;}
        .notifications-panel.show .panel-content{transform:scale(1);}
        .panel-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border-bottom:1px solid #ddd;}
        .close-notifications{background:none;border:none;font-size:1.8rem;cursor:pointer;}
        .notification-list{list-style:none;overflow-y:auto;padding:10px 20px;}
        .notification-item{padding:15px 0;border-bottom:1px solid #eee;}
        .notification-item:last-child{border-bottom:none;}
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="search-bar"><i class="fa-solid fa-search"></i><input type="search" id="search-input" placeholder="ابحث..."></div>
            <div id="notifications-icon" class="header-icon"><i class="fa-solid fa-bell"></i><div class="notification-count" id="notification-count">0</div></div>
            <div class="header-icon"><i class="fa-solid fa-user-circle"></i></div>
        </header>
        <main class="app-content" id="main-content">
            <section class="section active" id="games-section"><div class="section-header"><h2 class="section-title">الألعاب</h2></div><div class="apps-grid" id="games-grid"><div class="skeleton-card"><div class="img shimmer"></div><div class="text"><div class="name"></div><div class="dev"></div></div></div></div></section>
            <section class="section" id="apps-section"><div class="section-header"><h2 class="section-title">التطبيقات</h2></div><div class="apps-grid" id="apps-grid"><div class="skeleton-card"><div class="img shimmer"></div><div class="text"><div class="name"></div><div class="dev"></div></div></div></div></section>
        </main>
        <nav class="app-bottom-nav">
            <div class="nav-item active" id="nav-games"><i class="fa-solid fa-gamepad"></i><span>الألعاب</span></div>
            <div class="nav-item" id="nav-apps"><i class="fa-solid fa-shapes"></i><span>التطبيقات</span></div>
            <div class="nav-item" id="nav-books"><i class="fa-solid fa-book"></i><span>الكتب</span></div>
        </nav>
    </div>

    <!-- Detail page and notification panel HTML remain the same -->
    <div class="app-detail-page" id="app-detail-page"><!-- Content here --></div>
    <div class="notifications-panel" id="notifications-panel"><div class="panel-content"><div class="panel-header"><h3>الإشعارات</h3><button class="close-notifications" id="close-notifications-btn">&times;</button></div><ul class="notification-list" id="notification-list"></ul></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyAO437bK1g4Z-MjfCxBkk9AaGWoxqEHE50", authDomain: "amin-412e1.firebaseapp.com", projectId: "amin-412e1", storageBucket: "amin-412e1.firebasestorage.app", messagingSenderId: "536963344111", appId: "1:536963344111:web:9fab888b6f252b70ee1d1a", measurementId: "G-WEH9XN8EVD" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allAppsData = [];
        
        const appsGrid = document.getElementById('apps-grid');
        const gamesGrid = document.getElementById('games-grid');
        const searchInput = document.getElementById('search-input');
        const navGamesBtn = document.getElementById('nav-games');
        const navAppsBtn = document.getElementById('nav-apps');
        const gamesSection = document.getElementById('games-section');
        const appsSection = document.getElementById('apps-section');
        const appDetailPage = document.getElementById('app-detail-page');
        const notificationsIcon = document.getElementById('notifications-icon');
        const notificationsPanel = document.getElementById('notifications-panel');
        const notificationCount = document.getElementById('notification-count');
        const notificationList = document.getElementById('notification-list');
        const closeNotificationsBtn = document.getElementById('close-notifications-btn');

        onSnapshot(collection(db, "apps"), snapshot => {
            allAppsData = snapshot.docs.map(doc => ({...doc.data(), id: doc.id}));
            renderAppGrids(allAppsData);
        });
        
        onSnapshot(collection(db, "notifications"), snapshot => {
            renderNotifications(snapshot.docs.map(doc => ({...doc.data(), id: doc.id})));
        });

        function renderAppGrids(appsToRender) {
            const renderGrid = (container, apps) => {
                container.innerHTML = '';
                if(apps.length === 0) container.innerHTML = `<p>لا توجد عناصر لعرضها</p>`;
                apps.forEach((app, index) => {
                    const card = createAppCard(app);
                    card.style.animationDelay = `${index * 0.08}s`;
                    container.appendChild(card);
                });
            };
            renderGrid(appsGrid, appsToRender.filter(a => a.category === 'app'));
            renderGrid(gamesGrid, appsToRender.filter(a => a.category === 'game'));
        }

        function renderNotifications(notifs) {
            notificationCount.classList.toggle('show', notifs.length > 0);
            notificationCount.textContent = notifs.length;
            notificationList.innerHTML = '';
            if(notifs.length === 0) notificationList.innerHTML = `<li style="text-align:center; padding: 20px;">لا توجد إشعارات</li>`;
            notifs.forEach(n => {
                const item = document.createElement('li');
                item.className = 'notification-item';
                item.innerHTML = `<h4>${n.title}</h4><p>${n.message}</p>`;
                notificationList.appendChild(item);
            });
        }

        function createAppCard(app) {
            const card = document.createElement('div');
            card.className = 'app-card';
            card.addEventListener('click', () => openAppDetail(app));
            card.innerHTML = `
                <img src="${app.iconUrl}" alt="${app.name}">
                <div class="app-info">
                    <span class="app-name">${app.name}</span>
                    <span class="app-developer">${app.developer}</span>
                    <div class="app-rating">
                        <span>${app.rating}</span><i class="fa-solid fa-star"></i>
                    </div>
                </div>
                <a href="${app.installUrl}" target="_blank" rel="noopener noreferrer" class="download-btn">تحميل</a>`;
            card.querySelector('.download-btn').addEventListener('click', (e) => e.stopPropagation());
            return card;
        }

        function openAppDetail(app) {
            // This function needs the HTML for the detail page to be present
            appDetailPage.classList.add('show');
        }

        function switchTab(activeTab) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if (activeTab === 'games') {
                gamesSection.classList.add('active');
                navGamesBtn.classList.add('active');
            } else {
                appsSection.classList.add('active');
                navAppsBtn.classList.add('active');
            }
        }
        
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase().trim();
            const filteredApps = allAppsData.filter(app => app.name.toLowerCase().includes(query));
            renderAppGrids(filteredApps);
        });

        navGamesBtn.addEventListener('click', () => switchTab('games'));
        navAppsBtn.addEventListener('click', () => switchTab('apps'));
        notificationsIcon.addEventListener('click', () => notificationsPanel.classList.add('show'));
        closeNotificationsBtn.addEventListener('click', () => notificationsPanel.classList.remove('show'));
    </script>
</body>
</html>